const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const colors=["red","green","blue","cyan","magenta","yellow","pink",
    "orange","navy","plum","purple","salmon","brown","yellowgreen",
    "wheat","tan","steelblue","gray","skyblue","orangered","olive",
    "maroon","lime","khaki","indigo","indianred","gold","crimson",
    "chocolate","aqua","aquamarine" // beige
];
var ptrColor=0;
canvas.width=window.innerWidth; 
canvas.height=window.innerHeight;
ctx.translate(1.5,1.5);
ctx.lineWidth=3;
const d=Math.floor(Math.max(canvas.width/30, canvas.height/30));
const dx=Math.floor(canvas.width/d), dy=Math.floor(canvas.height/d);
var ms=0, lastFrame=0, delay=0, speeder=2;
const maze=new Maze();
const grid=[], opt=[], path=[], rands=[
    1,1,1,1,0,2,0,0,1,1,2,2,0,0,0,0,1,0,1,2,0,0,0,0,0,0,0,0,0,1,1,0,0,0,2,0,2,2,2,2,1,2,1,1,0,0,1,1,2,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,1,2,0,1,0,2,0,0,0,2,2,1,2,2,0,0,0,1,0,1,0,0,0,1,1,0,1,1,0,1,2,1,2,1,0,0,1,2,0,2,2,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,2,2,1,0,0,0,1,1,0,2,0,0,0,1,1,0,2,1,0,1,1,0,1,1,0,1,0,0,2,2,1,1,0,0,1,1,1,1,0,0,0,1,0,1,0,0,1,0,1,0,1,0,0,0,2,0,0,0,0,1,0,1,0,2,1,1,0,0,0,0,0,0,1,0,0,2,0,1,0,0,1,2,0,2,2,0,1,1,0,0,0,0,2,1,0,0,0,0,1,2,1,1,0,1,0,0,0,1,2,0,2,2,0,0,0,1,1,1,0,0,0,2,2,1,0,0,0,0,0,0,1,0,1,1,0,2,1,0,1,0,0,0,1,0,0,0,1,1,0,1,2,0,2,0,2,0,2,1,2,2,0,2,0,0,0,1,0,0,0,1,0,2,0,1,0,2,1,0,0,1,2,0,0,0,2,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,2,0,0,1,0,0,0,1,2,1,1,1,0,2,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,2,1,1,1,0,2,1,0,0,0,0,0,0,0,0,0,2,1,0,0,0,2,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2,1,0,1,1,1,2,0,1,0,1,1,1,2,1,0,0,1,2,0,0,0,0,2,0,2,1,1,0,0,1,0,2,1,1,0,0,0,1,0,2,1,1,0,1,1,0,0,0,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,2,2,1,1,1,1,1,1,1,0,0,0,2,2,0,0,0,0,0,0,0,0,0,2,0,0,0,1,2,1,0,0,0,0,0,0,2,2,0,2,0,2,0,1,1,2,0,0,1,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,0,0,1,0,0,1,0,2,0,1,0,1,2,1,0,2,0,2,0,1,1,0,1,1,0,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,1,0,0,2,0,1,0,0,2,2,0,1,0,0,0,0,0,1,0,0,0,2,0,1,1,1,0,2,0,1,0,2,0,1,0,0,2,2,1,2,1,1,0,1,1,0,1,2,1,0,0,1,0,0,0,0,0,0,1,2,2,0,2,0,1,0,1,2,0,2,1,0,0,0,1,0,1,0,0,2,0,0,0,2,1,0,1,2,0,2,2,2,0,1,1,0,0,2,2,2,1,0,0,0,0,1,0,0,0,1,2,0,1,1,1,0,1,0,1,0,1,1,2,2,0,2,2,2,2,0,2,0,1,1,2,0,0,0,0,0,1,0,0,1,0,1,0,1,1,0,2,1,1,2,0,0,0,2,2,2,1,1,0,0,0,0,0,1,1,0,0,1,2,1,0,0,0,0,0,1,0,0,1,2,0,0,0,0,1,2,0,0,0,1,0,1,0,0,0,2,2,2,0,0,2,2,1,1,1,2,2,0,2,0,0,2,2,0,0,0,2,2,0,2,2,0,1,1,0,1,1,1,1,2,0,1,0,0,1,2,0,0,1,0,2,1,1,0,1,1,0,2,0,2,1,0,2,0,1,0,1,1,1,1,0,2,0,2,0,0,0,0,2,2,1,2,2,1,1,0,2,1,1,0,0,1,1,1,2,1,2,1,0,0,0,0,1,1,1,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,1,2,1,0,0,0,0,2,1,0,0,2,1,1,2,2,1,0,0,1,0,0,0,0,1,1,1,0,0,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,0,0,0,2,0,1,1,2,0,1,1,0,0,2,0,0,2,2,1,1,0,0,0,0,0,0,1,2,0,2,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,0,0,1,1,0,2,1,1,0,1,1,1,0,0,0,0,2,2,1,1,2,1,1,0,0,0,1,0,2,0,0,0,0,1,0,2,0,0,1,1,1,0,2,0,2,1,0,0,0,0,1,0,1,2,1,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,1,1,2,2,0,0,1,2,1,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,
    0,2,1,1,0,0,2,1,0,0,1,0,0,0,0,0,0,1,1,0,0,2,0,0,1,0,2,0,1,0,1,1,1,1,2,2,0,2,2,1,1,2,0,0,1,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,1,0,0,0,0,0,1,0,0,0,0,1,0,2,1,1,0,0,0,0,1,0,0,0,0,1,0,2,0,1,0,0,0,0,0,1,1,1,1,1,1,2,0,1,2,0,0,1,2,1,2,0,0,0,2,1,2,1,0,0,1,2,1,1,1,0,1,1,2,2,1,1,0,2,0,0,0,0,1,0,1,1,1,1,2,2,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,2,0,0,0,1,1,0,0,2,1,0,0,0,2,0,0,2,0,1,0,2,1,2,1,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,
    0,0,0,2,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0,0,0,0,0,1,0,2,0,2,1,0,0,0,0,0,0,0,1,0,2,1,1,0,0,0,1,0,1,0,0,0,1,1,0,0,1,0,1,0,0,1,0,0,0,0,0,0,1,1,0,0,0,2,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,2,2,2,1,0,1,1,1,0,1,0,0,0,0,0,0,0,0,0,1,2,2,0,2,0,1,0,0,2,2,2,0,1,1,1,1,2,1,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,1,1,0,1,0,0,0,0,1,0,1,0,0,1,2,1,1,0,2,1,0,0,0,0,0,1,1,0,0,1,0,2,1,1,0,0,2,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,1,2,1,0,1,1,0,1,0,0,0,1,1,2,1,1,2,0,0,1,2,2,0,0,0,2,1,0,1,1,0,2,1,0,1,0,0,0,0,0,0,2,2,2,0,2,2,2,0,1,0,1,0,1,0,0,2,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,1,2,0,1,1,0,2,1,1,1,1,1,1,2,2,1,0,0,1,2,0,1,0,1,0,1,0,0,1,0,2,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,2,0,1,0,0,0,1,1,1,1,0,0,1,1,0,2,1,1,0,0,0,0,1,2,0,0,1,2,0,0,0,0,0,0,1,1,1,1,0,2,0,2,0,2,0,1,0,0,1,0,0,1,1,2,0,2,1,2,2,1,1,1,0,1,0,1,2,1,0,2,0,2,1,0,0,1,0,2,0,1,1,2,0,2,1,2,0,0,0,1,1,0,2,1,0,1,0,1,1,0,0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1,0,0,0,0,2,1,1,0,0,0,1,2,0,1,2,0,1,0,0,0,2,0,0,0,0,2,1,1,0,2,2,2,1,1,2,1,2,2,2,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,1,2,0,1,1,0,1,2,0,0,0,0,0,0,1,0,1,0,2,1,1,0,1,0,0,0,0,1,1,2,2,0,2,0,1,1,2,0,0,0,1,0,0,2,0,0,1,0,0,0,2,0,0,1,0,0,0,0,1,0,1,2,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,2,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2,1,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,1,1,0,1,1,1,1,1,1,0,0,1,2,0,1,0,0,0,0,0,0,1,0,1,1,0,1,1,0,1,0,1,1,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,1,1,1,0,0,1,1,0,0,0,1,1,1,2,0,2,0,0,1,2,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,2,0,1,0,1,1,2,0,0,0,1,2,0,0,0,0,0,0,0,0,1,2,0,0,1,0,0,1,2,2,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,0,1,1,0,2,1,0,2,0,1,0,2,1,2,2,1,1,0,1,0,0,0,0,1,1,1,1,1,2,2,0,0,0,0,1,2,1,1,0,1,2,2,0,2,2,1,1,2,1,2,2,1,1,1,1,1,0,1,1,0,0,2,1,0,1,0,0,0,1,2,1,0,0,0,0,0,0,1,0,1,2,2,2,0,1,1,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,1,1,1,0,2,1,1,1,0,0,0,0,0,0,0,1,1,0,1,1,2,1,0,0,1,0,1,0,0,2,0,2,0,0,1,0,2,1,2,1,2,0,0,2,0,2,0,1,1,0,2,0,1,1,1,2,0,0,1,2,0,0,0,2,0,2,0,1,0,2,1,2,1,0,0,0,0,0,0,1,1,1,1,2,1,1,0,1,1,1,0,2,0,1,1,1,1,1,2,1,1,0,2,1,1,1,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,2,0,2,2,1,0,0,0,0,1,0,2,2,0,0,0,0,1,2,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1,1,2,1,1,0,1,1,0,1,0,2,0,0,0,1,1,0,0,1,0,2,0,0,1,2,0,2,0,0,1,1,0,0,0,1,1,2,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,2,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,0,0,2,0,1,1,1,0,0,1,1,2,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,1,2,0,0,1,2,0,0,0,0,1,0,1,1,1,0,0,0,0,0,0,0,1,0,2,0,1,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1,2,0,0,0,2,0,2,2,1,1,0,0,0,0,0,0,0,0,1,1,0,1,1,0,2,1,0,0,0,0,0,1,0,1,2,2,0,0,0,1,1,1,0,0,1,1,0,2,1,1,0,0,1,2,0,1,1,1,0,2,1,0,1,0,0,2,0,
    1,1,1,2,2,0,0,1,1,1,1,0,0,0,0,0,1,2,0,2,0,2,0,1,1,2,0,2,1,2,0,0,1,1,1,2,1,2,0,1,1,0,0,1,1,2,2,2,0,0,2,0,1,0,0,2,1,0,2,1,2,1,0,0,0,0,0,0,0,0,0,1,2,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2,0,0,1,1,0,0,2,2,1,1,0,1,0,0,0,0,1,0,1,0,0,2,2,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,2,1,1,0,1,0,0,0,1,0,0,0,0,2,0,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,1,1,0,2,2,0,1,1,0,1,0,0,0,1,1,0,0,0,0,1,0,0,1,0,2,0,0,2,0,2,0,2,1,0,0,0,0,1,1,0,0,2,2,1,1,0,0,2,0,2,0,1,0,2,1,1,0,0,1,2,0,2,0,0,1,2,0,1,0,1,0,2,0,1,1,2,0,0,0,2,0,1,0,1,1,2,2,0,0,1,0,0,0,1,1,2,0,0,1,0,0,1,0,2,1,1,1,1,1,1,0,0,0,2,2,1,2,1,1,1,0,1,1,0,1,1,1,2,0,0,0,0,2,0,0,1,1,1,1,1,1,2,1,0,0,0,0,0,2,0,0,0,2,1,1,1,1,0,0,0,0,0,0,1,0,0,1,2,0,1,1,0,0,2,2,0,0,1,0,0,0,1,0,1,1,2,0,2,2,1,2,0,0,0,1,1,0,0,1,1,2,2,0,2,0,2,0,0,1,0,0,1,1,1,1,0,1,1,0,2,0,2,1,0,0,0,0,1,2,1,0,2,0,2,0,2,0,1,1,1,0,2,0,0,0,1,1,2,2,0,0,0,0,1,1,2,2,0,0,1,0,1,2,2,1,1,2,2,2,1,2,2,2,0,0,1,2,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,2,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,2,0,1,1,0,2,1,0,1,0,2,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,1,2,1,0,0,0,0,1,0,2,1,0,0,0,0,0,1,1,1,0,0,2,0,0,2,0,2,0,2,2,2,0,2,1,0,2,0,0,0,0,2,0,0,1,2,0,1,0,2,0,0,1,2,0,0,1,1,0,2,0,1,0,1,2,1,0,2,1,0,0,1,2,0,0,0,1,2,0,0,0,2,1,0,1,1,0,1,1,2,1,1,2,1,0,0,0,1,0,0,2,1,0,0,0,1,0,0,0,0,1,0,2,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,2,1,2,1,1,1,1,0,0,1,0,2,1,1,1,1,0,2,2,1,2,2,0,1,0,2,0,0,1,2,0,0,1,0,2,0,2,1,0,0,1,2,0,1,1,1,0,1,2,0,0,1,0,1,0,2,2,0,0,2,0,2,0,1,1,1,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,2,0,1,0,1,0,2,2,1,2,1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,1,1,0,1,1,1,2,1,2,0,0,0,0,2,0,2,1,0,0,0,1,1,2,0,0,0,0,1,0,1,1,0,0,0,0,1,0,1,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,2,1,0,1,0,0,0,0,1,0,1,0,1,1,0,2,1,1,0,1,0,1,2,0,0,0,1,0,2,1,2,1,0,0,0,1,2,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,1,2,2,2,2,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,2,0,0,1,1,2,1,0,2,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,1,1,0,0,0,0,1,1,0,0,0,0,0,2,0,0,2,0,2,2,0,0,0,0,0,0,1,0,1,0,2,1,1,0,1,0,0,0,1,1,1,1,0,2,0,1,0,1,2,0,0,0,1,1,1,1,0,1,0,0,1,0,0,0,2,1,2,0,0,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,1,0,0,0,1,0,0,0,1,2,1,0,0,1,0,1,1,0,0,1,0,1,1,0,1,1,0,0,1,0,2,2,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,1,1,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,2,1,0,0,0,0,0,0,0,0,0,0,0,1,2,0,1,2,2,0,2,0,0,0,0,1,2,1,1,1,1,2,2,2,1,0,1,0,1,1,1,2,2,0,2,2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,1,0,1,0,1,0,0,0,1,0,2,1,1,0,1,0,0,0,0,0,2,0,2,0,1,1,2,1,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,2,2,0,1,0,0,1,1,0,2,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,0,1,2,0,2,0,0,0,1,0,1,1,0,1,1,0,2,1,0,0,0,1,1,1,1,0,1,0,0,2,0,0,0,0,0,1,1,2,1,2,0,0,0,1,0,0,1,1,0,0,0,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,2,1,2,1,1,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,1,2,0,1,2,1,0,1,1,1,1,0,2,0,1,1,0,0,0,0,2,0,0,1,1,0,2,1,0,1,0,1,0,1,1,1,1,1,0,2,0,0,0,1,1,0,0,0,0,2,0,0,1,2,0,0,0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,1,0,2,0,1,0,0,1,0,0,1,1,2,2,0,0,1,1,0,0,0,1,0,1,2,0,0,1,1,1,1,0,1,0,0,0,0,0,0,0,1,0,0,0,2,2,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,1,1,0,0,2,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,1,0,1,1,0,0,0,1,0,2,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,1,0,2,2,0,0,0,2,1,1,0,1,0,0,0,0,1,0,0,1,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,2,0,0,0,1,1,0,2,0,0,2,2,0,0,0,0,1,0,2,2,0,0,0,0,0,0,0,1,0,2,0,0,0,0,1,1,0,1,1,2,1,2,2,0,2,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,2,1,0,2,1,1,0,0,0,1,2,0,1,1,0,1,2,1,0,2,0,1,1,0,2,1,0,1,1,0,0,0,0,0,0,2,1,0,0,0,1,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,2,0,1,0,2,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,2,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,2,1,1,0,0,1,0,0,0,0,0,0,1,2,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,1,0,0,1,1,1,2,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,2,0,1,0,1,0,0,0,1,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,2,0,1,1,2,0,0,0,0,0,2,0,1,1,2,0,2,1,0,0,0,0,0,1,2,1,0,0,0,1,1,0,0,2,2,1,1,0,1,2,0,0,1,2,0,1,0,0,2,1,0,0,0,0,0,0,0,1,2,0,0,1,0,1,1,0,1,1,1,0,1,0,0,2,
    1,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,2,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,2,0,1,1,0,0,2,1,0,0,1,0,0,0,2,1,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1,0,2,0,0,0,0,0,1,1,2,0,0,0,1,0,0,2,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,1,0,0,0,0,1,0,0,1,2,1,0,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,1,2,0,1,0,0,0,1,2,2,0,0,0,1,0,0,0,1,2,1,1,0,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,2,1,0,0,1,0,1,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,2,2,2,2,0,1,1,0,0,0,0,2,0,0,0,1,1,0,1,0,1,0,0,0,0,0,1,1,0,0,2,0,1,0,0,0,1,2,0,0,0,1,0,0,0,0,0,1,1,0,2,1,1,2,0,0,0,0,2,1,0,0,0,0,1,1,1,0,1,0,2,0,0,0,2,2,0,1,0,0,0,1,1,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,0,0,0,0,0,2,0,1,1,0,1,0,2,0,0,0,1,2,0,2,0,2,0,0,0,1,0,2,0,2,1,1,0,0,0,2,1,0,1,1,0,0,0,0,1,0,2,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,0,0,1,1,1,0,0,1,0,0,0,0,0,1,2,1,0,1,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,2,0,1,1,2,1,0,2,1,2,2,1,0,0,1,1,0,0,0,1,2,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,1,1,0,1,1,0,1,1,0,1,1,0,0,0,2,2,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,2,1,0,1,1,0,0,1,1,2,0,0,0,0,1,1,0,0,0,0,0,1,2,2,0,2,0,0,2,0,1,1,2,1,0,0,0,0,0,2,1,0,1,1,2,2,1,1,1,1,1,1,0,1,0,2,0,0,0,1,1,1,0,1,1,0,1,0,1,0,0,0,2,1,1,0,0,0,2,0,1,1,2,0,0,0,0,0,0,0,0,2,1,1,0,2,1,1,0,0,1,1,0,0,1,1,0,0,1,2,1,1,0,0,0,2,2,1,1,1,2,1,1,0,0,0,1,0,1,0,0,1,0,1,1,1,2,1,0,0,0,1,1,2,1,2,1,0,0,2,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,2,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,1,1,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,1,1,
    0,2,0,2,1,0,0,0,0,0,1,0,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,1,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
];
var ptrRands=0;

for (let i=0; i<dx; i++) {
    for (let j=0; j<dy; j++) {
        if (j<dy-1 && !(i==0 && j==0) && !(i==dx-1 && j==dy-2)) {
            grid.push(new Wall(new Point(i,j),new Point(i,j+1)));
        }
        if (i<dx-1) {
            grid.push(new Wall(new Point(i,j),new Point(i+1,j)));
        }
    }
}

function clearScreen() {
    ctx.fillStyle="white";
    ctx.fillRect(0,0,canvas.width,canvas.height);
}

function removeCrossingWall(p1,p2) {
    grid.forEach((v,i)=>{
        if (v.p1.x==p1.x && v.p1.y==p1.y && v.p2.x==p1.x && p2.x-p1.x==-1 ||
            v.p1.x==p1.x && v.p1.y==p1.y && v.p2.y==p1.y && p2.y-p1.y==-1 ||
            v.p1.x==p1.x+1 && v.p1.y==p1.y && v.p2.x==v.p1.x && p2.x-p1.x==1 ||
            v.p1.x==p1.x && v.p1.y==p1.y+1 && v.p2.y==v.p1.y && p2.y-p1.y==1
        ) {
            grid.splice(i,1);
        }
    });
}

function drawGrid() {
    ctx.beginPath();
    grid.forEach(g=>{
        ctx.moveTo(d*g.p1.x,d*g.p1.y);
        ctx.lineTo(d*g.p2.x,d*g.p2.y);
    })
    ctx.stroke();
}

function drawPath() {
    path.forEach(g=>{
        ctx.beginPath();
        ctx.strokeStyle=g.color;
        ctx.moveTo(d*g.wall.p1.x+d/2,d*g.wall.p1.y+d/2);
        ctx.lineTo(d*g.wall.p2.x+d/2,d*g.wall.p2.y+d/2);
        ctx.stroke();
    })
}

function mazeFull() {
    var ret=true;
    maze.m.forEach(rows=>{
        rows.forEach(cell=>{if (cell=='.') ret=false;})
    });
    return ret;
}

function drawMaze() {
    ctx.beginPath();
    for (let i=0; i<dx-1; i++) {
        for (let j=0; j<dy-1; j++) {
            if (maze.m[i][j]=='.') {
                ctx.moveTo(d*i+d/2-1, d*j+d/2-1);
                ctx.lineTo(d*i+d/2, d*j+d/2);
            }
            else if (maze.m[i][j]=='o') {
                ctx.moveTo(d*i+d/2+5, d*j+d/2);
                ctx.arc(d*i+d/2,d*j+d/2,d/5,0,2*Math.PI);
            }
        }
    }
    ctx.stroke();
}

function process() {
    maze.m[x][y]='o';
    var dir0=[];
    dir.forEach(d=>{
        if (x+d[0]<0 || x+d[0]>=dx-1 || y+d[1]<0 || y+d[1]>=dy-1) {
        }
        else if (maze.m[x+d[0]][y+d[1]]=='o') {
        }
        else {
            dir0.push(d);
        }
    });
    var r=Math.floor(dir0.length*Math.random());
    rands.push(r);
//    r=rands[ptrRands++];
    var d=dir0[r];
    if (dir0.length>=1) {
        dir0.splice(r,1);
        dir0.forEach(o=>opt.push([x,y,o]));
        var p1=new Point(x,y);
        x=x+d[0]; y=y+d[1];
        var p2=new Point(x,y);
        path.push({ color: colors[ptrColor], wall: new Wall(p1,p2) });
        removeCrossingWall(p1,p2);
    }
    else if (dir0.length==0) {
        ptrColor=(ptrColor+1)%colors.length;
        do {
            var o=opt.shift();
            if (o) { x=o[0]; y=o[1]; d=o[2]; }
            else { 
//                alert("most szÃ¡ll el?"); 
            }
        } while (!mazeFull() && o!=null && maze.m[x+d[0]][y+d[1]]!='.')
    }
}

var x=0, y=0;

function animate() {
    ms=Date.now();
    if (ms>=lastFrame+delay) {
        clearScreen();
        ctx.strokeStyle="black";
        drawGrid();
        //drawMaze();
        ctx.strokeStyle="red";
        drawPath();
        lastFrame=ms;
        for (let i=0; i<speeder; i++) process();
    }
    if (mazeFull()) {
        clearScreen();
        ctx.strokeStyle="black";
        drawGrid();
    }
    else requestAnimationFrame(animate);
}

animate();
